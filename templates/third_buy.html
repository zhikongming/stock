<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¬¢è¿ä½¿ç”¨è‚¡ç¥¨åˆ†æç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="./common.css">
    <script src="./common.js"></script>
</head>
<body>
    <div class="page-container">
        <div class="header">
            <h1>
                <i class="fas fa-chart-pie"></i>
                ç¬¬ä¸‰ç±»ä¹°ç‚¹ç­›é€‰åˆ†æ
            </h1>
            <p>æ ¹æ®è®¾å®šçš„æŠ€æœ¯æŒ‡æ ‡ç­›é€‰ç¬¦åˆæ¡ä»¶çš„æ¿å—ï¼Œæ”¯æŒæŒ‰èµ·å§‹æ—¥æœŸæˆ–å¤©æ•°æŸ¥è¯¢(<a href="https://mp.weixin.qq.com/s/DRhukSFwJOosKIDTqj0V0w" class="no-underline" target="_blank">ç‚¹å‡»æŸ¥çœ‹ç†è®º</a>)</p>
        </div>
        <div class="form-container">
            <div class="form-header">
                <i class="fas fa-sliders-h"></i>
                <h2>ç­›é€‰æ¡ä»¶è®¾ç½®</h2>
            </div>
            <form id="filter-form">
                <div class="form-grid">
                    <!-- æ¿å—åç§° -->
                    <div class="form-group">
                        <label class="form-label" for="sector-name">
                            <i class="fas fa-tag"></i>
                            <span>æ¿å—åç§°</span>
                        </label>
                        <input list="sector-options" type="text" id="sector-name" class="form-control" placeholder="è¯·è¾“å…¥æˆ–é€‰æ‹©æ¿å—åç§°" value="è´µé‡‘å±">
                        <datalist id="sector-options">
                            <!-- javascriptæ¥ç”Ÿæˆæ•°æ® -->
                        </datalist>
                        <span class="form-hint">æ”¯æŒè¾“å…¥æœç´¢ï¼Œä»ä¸‹æ‹‰åˆ—è¡¨é€‰æ‹©æˆ–è‡ªå®šä¹‰è¾“å…¥</span>
                    </div>
                    
                    <!-- æŸ¥è¯¢æ–¹å¼é€‰æ‹© -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-search"></i>
                            <span>æŸ¥è¯¢æ–¹å¼</span>
                        </label>
                        <div class="radio-group">
                            <label class="radio-item">
                                <input type="radio" name="query-type" value="date" checked id="type-date">
                                <span>æŒ‰èµ·å§‹æ—¥æœŸ</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="query-type" value="days" id="type-days">
                                <span>æŒ‰å¤©æ•°</span>
                            </label>
                        </div>
                        <span class="form-hint">èµ·å§‹æ—¥æœŸå’Œå¤©æ•°ä»…ä¸€ä¸ªç”Ÿæ•ˆ</span>
                    </div>
                    
                    <!-- èµ·å§‹æ—¥æœŸ -->
                    <div class="form-group" id="date-group">
                        <label class="form-label" for="start-date">
                            <i class="fas fa-calendar-alt"></i>
                            <span>èµ·å§‹æ—¥æœŸ</span>
                        </label>
                        <input type="date" id="start-date" class="form-control" value="2026-01-01">
                        <span class="form-hint">åˆ†æè‚¡ç¥¨ä»·æ ¼åœ¨èµ·å§‹æ—¥æœŸçš„æ•°æ®</span>
                    </div>
                    
                    <!-- å¤©æ•° -->
                    <div class="form-group" id="days-group">
                        <label class="form-label" for="days">
                            <i class="fas fa-clock"></i>
                            <span>å¤©æ•°</span>
                        </label>
                        <input type="number" id="days" class="form-control" placeholder="ä¾‹å¦‚ï¼š30" min="1" max="365" disabled>
                        <span class="form-hint">æ­£æ•´æ•°ï¼Œæœ€è¿‘Nä¸ªäº¤æ˜“æ—¥</span>
                    </div>
                    
                    <!-- ä¸Šæ¶¨å¹…åº¦æœ€ä½é˜ˆå€¼ -->
                    <div class="form-group">
                        <label class="form-label" for="threshold-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>ä¸Šæ¶¨å¹…åº¦æœ€ä½é˜ˆå€¼ (%)</span>
                        </label>
                        <input type="number" id="threshold-up" class="form-control" placeholder="ä¾‹å¦‚ï¼š5" step="0.1" min="0" value="20">
                        <span class="form-hint">ä¸Šæ¶¨å¹…åº¦æœ€ä½é˜ˆå€¼ï¼Œå»ºè®®ä¸Šæ¶¨çš„é˜ˆå€¼è®¾ç½®ä¸ºè‡³å°‘20æ‰æœ‰è¶³å¤Ÿçš„åˆ©æ¶¦ç©ºé—´</span>
                    </div>
                    
                    <!-- å›è°ƒå¹…åº¦æœ€ä½é˜ˆå€¼ -->
                    <div class="form-group">
                        <label class="form-label" for="threshold-pullback">
                            <i class="fas fa-arrow-down"></i>
                            <span>å›è°ƒå¹…åº¦æœ€ä½é˜ˆå€¼ (%)</span>
                        </label>
                        <input type="number" id="threshold-pullback" class="form-control" placeholder="ä¾‹å¦‚ï¼š2" step="0.1" min="0" value="15">
                        <span class="form-hint">å›è°ƒå¹…åº¦æœ€ä½é˜ˆå€¼ï¼Œå»ºè®®å›è°ƒçš„é˜ˆå€¼è®¾ç½®ä¸ºè‡³å°‘15æ‰æœ‰è¶³å¤Ÿçš„åˆ©æ¶¦ç©ºé—´</span>
                    </div>
                    
                    <!-- åç¦»åº¦æœ€å¤§é˜ˆå€¼ -->
                    <div class="form-group">
                        <label class="form-label" for="threshold-deviation">
                            <i class="fas fa-chart-bar"></i>
                            <span>åç¦»åº¦æœ€å¤§é˜ˆå€¼ (%)</span>
                        </label>
                        <input type="number" id="threshold-deviation" class="form-control" placeholder="ä¾‹å¦‚ï¼š10" step="0.1" min="0" value="5">
                        <span class="form-hint">åç¦»åº¦æœ€å¤§é˜ˆå€¼ï¼Œå»ºè®®åç¦»åº¦çš„é˜ˆå€¼ä¸å®œè¿‡å¤§æˆ–è€…è¿‡å°</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="threshold-profit">
                            <i class="fas fa-sack-dollar"></i>
                            <span>æ½œåœ¨åˆ©æ¶¦æœ€å°é˜ˆå€¼ (%)</span>
                        </label>
                        <input type="number" id="threshold-profit" class="form-control" placeholder="ä¾‹å¦‚ï¼š10" step="0.1" min="0" value="15">
                        <span class="form-hint">æ½œåœ¨åˆ©æ¶¦æœ€å°é˜ˆå€¼ï¼ŒæŒ‰ç…§ä¸­æ¢ç›˜æ•´æ¥æ“çºµ, å»ºè®®æ½œåœ¨åˆ©æ¶¦çš„é˜ˆå€¼è®¾ç½®ä¸ºè‡³å°‘15æ‰æœ‰è¶³å¤Ÿçš„æ“ä½œä»·å€¼</span>
                    </div>

                    <div class="form-group full-width">
                        <div style="display: flex; justify-content: flex-end; ">
                            <button type="submit" class="submit-btn">
                                <i class="fas fa-search"></i>
                                <span>æäº¤ç­›é€‰</span>
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- è¡¨æ ¼åŒºåŸŸ -->
        <div class="table-container" id="table-container" style="display: none;" tabindex="-1">
            <div class="table-header">
                <h2 class="table-title">
                    <i class="fas fa-table"></i>
                    <span>ä¸ªè‚¡ä¸‰ç±»ä¹°ç‚¹æ˜ç»†è¡¨</span>
                </h2>
                <div class="table-info">
                    å…± <span id="table-count">0</span> ä¸ªæ ‡çš„(æ¿å—å…± <span id="total-count">0</span> ä¸ª)
                </div>
            </div>
            <div class="table-header-actions">
                <button id="show-subscribed-btn" class="action-btn2 primary">
                    <i class="fas fa-eye"></i>
                    <span>åªçœ‹è®¢é˜…</span>
                </button>
                <button id="clear-subscriptions-btn" class="action-btn2 warning">
                    <i class="fas fa-trash-alt"></i>
                    <span>æ¸…é™¤è®¢é˜…</span>
                </button>
            </div>
            <table class="table-content-header" id="period-table">
                <thead>
                    <tr>
                        <th>æ ‡çš„</th>
                        <th>ä¸Šæ¶¨é˜¶æ®µ</th>
                        <th>ä¸‹è·Œé˜¶æ®µ</th>
                        <th>å†æ¬¡ä¸Šæ¶¨</th>
                        <th>å¯æ“ä½œé˜¶æ®µ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="period-tbody">
                    <!-- åŠ¨æ€æ¸²æŸ“æ•°æ® -->
                </tbody>
            </table>
            
            <div id="empty-state" class="empty-state" style="display: none;">
                <i class="fas fa-database"></i>
                <h3>æš‚æ— ç¬¦åˆæ¡ä»¶çš„ä¸‰ç±»ä¹°ç‚¹æ•°æ®</h3>
                <p>è¯·è°ƒæ•´ç­›é€‰æ¡ä»¶åé‡è¯•</p>
            </div>
        </div>
    </div>

    <script>
        const sectorOptions = document.getElementById("sector-options");
        const typeDate = document.getElementById('type-date');
        const typeDays = document.getElementById('type-days');
        const startDateInput = document.getElementById('start-date');
        const daysInput = document.getElementById('days');
        const form = document.getElementById('filter-form');
        const sectorName = document.getElementById('sector-name');
        const thresholdUp = document.getElementById('threshold-up');
        const thresholdPullback = document.getElementById('threshold-pullback');
        const thresholdDeviation = document.getElementById('threshold-deviation');
        const thresholdProfit = document.getElementById('threshold-profit');
        const resultTbody = document.getElementById('period-tbody');
        const resultCount = document.getElementById('table-count');
        const totalCount = document.getElementById('total-count');
        const emptyResult = document.getElementById('empty-state');
        const tableContainer = document.getElementById('table-container');
        const showSubscribedBtn = document.getElementById('show-subscribed-btn');
        const clearSubscriptionsBtn = document.getElementById('clear-subscriptions-btn');

        let industryList = [];
        let stockList = [];
        // å½“å‰æ˜¯å¦åªæ˜¾ç¤ºè®¢é˜…
        let showSubscribedOnly = false;

        function generateIndustryData() {
            let resp = getIndustryBasicData();
            resp.then(data => {
                data.forEach(item => {
                    industryList.push(item);
                });
                generateIndustryOptions();
            });
        }

        function generateIndustryOptions() {
            industryList.forEach(item => {
                let option = document.createElement("option");
                option.value = item.industry_name;
                sectorOptions.appendChild(option);
            });
        }

        function initQueryType() {
            // åˆå§‹åŒ–ï¼šæŒ‰èµ·å§‹æ—¥æœŸï¼Œå¯ç”¨èµ·å§‹æ—¥æœŸï¼Œç¦ç”¨å¤©æ•°
            startDateInput.disabled = false;
            daysInput.disabled = true;
            daysInput.value = '';
        }

        // è¡¨å•æäº¤
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const queryType = document.querySelector('input[name="query-type"]:checked');
            const sectorNameValue = sectorName.value.trim();
            const queryTypeValue = queryType.value;
            const thresholdUpValue =  parseFloat(thresholdUp.value);
            const thresholdPullbackValue =  parseFloat(thresholdPullback.value);
            const thresholdDeviationValue =  parseFloat(thresholdDeviation.value);
            const thresholdProfitValue =  parseFloat(thresholdProfit.value);
            const daysInputValue =  parseInt(daysInput.value);
            const startDateInputValue = startDateInput.value;

            // if (!sectorNameValue) {
            //     alert("è¯·è¾“å…¥è¡Œä¸šåç§°");
            //     return;
            // }
            let params = {
                industry_name: sectorNameValue,
                threshold_up: thresholdUpValue,
                threshold_pullback: thresholdPullbackValue,
                threshold_deviation: thresholdDeviationValue,
                threshold_profit: thresholdProfitValue,
            };
            if (queryTypeValue === 'date') {
                if (!startDateInput.value) {
                    alert("è¯·è¾“å…¥èµ·å§‹æ—¥æœŸ");
                    return;
                }
                params.start_date = startDateInputValue;
            } else {
                if (!daysInput.value) {
                    alert("è¯·è¾“å…¥å¤©æ•°");
                    return;
                }
                params.days = daysInputValue;
            }
            
            let resp = filterThirdBuyCode(params);
            resp.then(data => {
                stockList = data;
                renderTable(data);
            });
        });

        // æ ¼å¼åŒ–æ•°å­—ï¼Œä¿ç•™ä¸¤ä½å°æ•°
        function formatNumber(value) {
            return parseFloat(value).toFixed(2);
        }

        function formatRateWithSign(period) {
            if (!period) return '--';
            const rate = parseFloat(period.rate);
            // å¦‚æœæœ‰ä»·æ ¼æ•°æ®ï¼Œæ ¹æ®ä»·æ ¼æ¯”è¾ƒå†³å®šæ­£è´Ÿå·
            if (period.startPrice !== undefined && period.endPrice !== undefined) {
                if (period.endPrice > period.startPrice) {
                    return `+${rate.toFixed(2)}%`;
                } else if (period.endPrice < period.startPrice) {
                    return `-${rate.toFixed(2)}%`;
                } else {
                    return `${rate.toFixed(2)}%`;
                }
            }
            // æ²¡æœ‰ä»·æ ¼æ—¶ï¼Œç›´æ¥æ˜¾ç¤ºrateï¼ˆä¿ç•™ä¸¤ä½ï¼‰
            return `${rate.toFixed(2)}%`;
        }

        // æ ¼å¼åŒ–æ—¥æœŸåŒºé—´
        function formatDateRange(period) {
            if (!period) return '--';
            const { startDate, endDate } = period;
            if (!startDate) return '--';
            if (!endDate || startDate === endDate) {
                return `<i class="far fa-calendar-alt"></i> ${startDate}`;
            }
            return `<i class="far fa-calendar-alt"></i> ${startDate} â†’ ${endDate}`;
        }

        // æ ¼å¼åŒ–ä»·æ ¼ä¿¡æ¯ï¼ˆæ‚¬æµ®æç¤ºï¼‰
        function formatPriceInfo(period) {
            if (!period || !period.startPrice) return '';
            if (period.endPrice !== undefined) {
                return `ğŸ’° ${formatNumber(period.startPrice)} â†’ ${formatNumber(period.endPrice)}`;
            }
            return `ğŸ’° ${formatNumber(period.startPrice)}`;
        }

        function renderTable(data) {
            let rows = data.data;
            tableContainer.style.display = 'block';
            tableContainer.setAttribute('tabindex', '-1');
            tableContainer.focus();
            tableContainer.scrollIntoView({ behavior: 'smooth' });
            resultTbody.innerHTML = '';

            // è¿‡æ»¤è®¢é˜…è‚¡ç¥¨
            if (showSubscribedOnly) {
                const subscribed = getSubscribedStocks();
                const subscribedCodes = new Set(subscribed.map(s => s.code));
                rows = rows.filter(item => subscribedCodes.has(item.code));
            }

            if (rows.length === 0) {
                resultCount.textContent = '0';
                emptyResult.style.display = 'block';
                return;
            }
                
            emptyResult.style.display = 'none';
            resultCount.textContent = rows.length;
            totalCount.textContent = data.total;

            rows.forEach(item => {
                const tr = document.createElement('tr');
                
                // 1. æ ‡çš„ï¼ˆåç§°+ä»£ç ï¼‰
                const tdStock = document.createElement('td');
                tdStock.innerHTML = `
                    <div class="stock-info">
                        <span class="stock-name">${item.name}</span>
                        <span class="stock-code">${item.code}</span>
                        <span class="stock-industry">${item.industryName}</span>
                    </div>
                `;
                tr.appendChild(tdStock);
                
                // 2. ä¸Šæ¶¨é˜¶æ®µ
                const tdUp = document.createElement('td');
                tdUp.innerHTML = `
                    <div class="period-cell">
                        <span class="period-rate positive">
                            <i class="fas fa-arrow-up"></i> ${formatRateWithSign(item.upPeriod)}
                        </span>
                        <span class="period-date">${formatDateRange(item.upPeriod)}</span>
                        <span class="period-price" title="èµ·æ­¢ä»·æ ¼">${formatPriceInfo(item.upPeriod)}</span>
                    </div>
                `;
                tr.appendChild(tdUp);
                
                // 3. ä¸‹è·Œé˜¶æ®µ
                const tdDown = document.createElement('td');
                tdDown.innerHTML = `
                    <div class="period-cell">
                        <span class="period-rate negative">
                            <i class="fas fa-arrow-down"></i> ${formatRateWithSign(item.downPeriod)}
                        </span>
                        <span class="period-date">${formatDateRange(item.downPeriod)}</span>
                        <span class="period-price" title="èµ·æ­¢ä»·æ ¼">${formatPriceInfo(item.downPeriod)}</span>
                    </div>
                `;
                tr.appendChild(tdDown);
                
                // 4. å†æ¬¡ä¸Šæ¶¨
                const tdReup = document.createElement('td');
                tdReup.innerHTML = `
                    <div class="period-cell">
                        <span class="period-rate ${parseFloat(item.reupPeriod?.rate) > 0 ? 'positive' : ''}">
                            <i class="fas fa-arrow-up"></i> ${formatRateWithSign(item.reupPeriod)}
                        </span>
                        <span class="period-date">${formatDateRange(item.reupPeriod)}</span>
                        <span class="period-price" title="èµ·æ­¢ä»·æ ¼">${formatPriceInfo(item.reupPeriod)}</span>
                    </div>
                `;
                tr.appendChild(tdReup);
                
                // 5. æœ€ç»ˆé˜¶æ®µï¼ˆfinalPeriodæ²¡æœ‰endDateï¼‰
                const tdFinal = document.createElement('td');
                // æœ€ç»ˆé˜¶æ®µå•ç‹¬å¤„ç†ï¼Œå› ä¸ºæ²¡æœ‰endDate
                let finalRateHtml = '';
                if (item.finalPeriod) {
                    const rate = parseFloat(item.finalPeriod.rate);
                    const isPositive = item.finalPeriod.endPrice > item.finalPeriod.startPrice;
                    finalRateHtml = `
                        <span class="period-rate ${isPositive ? 'positive' : 'negative'}">
                            <i class="fas ${isPositive ? 'fa-arrow-up' : 'fa-arrow-down'}"></i> 
                            ${isPositive ? '+' : '-'}${Math.abs(rate).toFixed(2)}%
                        </span>
                    `;
                }
                tdFinal.innerHTML = `
                    <div class="period-cell">
                        ${finalRateHtml}
                        <span class="period-date">
                            <i class="far fa-calendar-alt"></i> ${item.finalPeriod?.startDate || '--'}
                        </span>
                        <span class="period-price" title="èµ·å§‹ä»·æ ¼ â†’ æœ€ç»ˆä»·æ ¼">
                            ğŸ’° ${item.finalPeriod ? formatNumber(item.finalPeriod.startPrice) + ' â†’ ' + formatNumber(item.finalPeriod.endPrice) : '--'}
                        </span>
                    </div>
                `;
                tr.appendChild(tdFinal);
                
                // 6. æ“ä½œæŒ‰é’®ï¼ˆè¯¦æƒ…/æŸ¥çœ‹ï¼‰
                const tdAction = document.createElement('td');
                const subscribed = isSubscribed(item.code);
                tdAction.innerHTML = `
                    <button class="stock-action-btn detail-btn" onclick="window.open('${getXueqiuStockUrl(item.code)}', '_blank')">
                        <i class="fas fa-chart-bar"></i>
                        <span>è¯¦æƒ…</span>
                    </button>
                    <button class="stock-action-btn subscribe-btn ${subscribed ? 'subscribed' : ''}" data-code="${item.code}" data-name="${item.name}">
                        <i class="fas ${subscribed ? 'fa-check-circle' : 'fa-bell'}"></i>
                        <span>${subscribed ? 'å·²è®¢é˜…' : 'è®¢é˜…'}</span>
                    </button>
                `;
                tr.appendChild(tdAction);
                
                resultTbody.appendChild(tr);
            });

            initSubscribeButtons();
        }

        function initSubscribeButtons() {
            // ä¸ºæ‰€æœ‰è®¢é˜…æŒ‰é’®ç»‘å®šäº‹ä»¶
            document.querySelectorAll('.subscribe-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const code = btn.dataset.code;
                    const name = btn.dataset.name;
                    const stock = { code, name };
                    toggleSubscribe(stock);
                    // ç”±äºtoggleSubscribeä¼šé‡æ–°æ¸²æŸ“ï¼Œä¸éœ€è¦é¢å¤–æ“ä½œ
                });
            });
        }

        // åˆ‡æ¢åªçœ‹è®¢é˜…æ¨¡å¼
        function toggleShowSubscribed() {
            showSubscribedOnly = !showSubscribedOnly;
            const btn = document.getElementById('show-subscribed-btn');
            if (showSubscribedOnly) {
                btn.innerHTML = '<i class="fas fa-eye-slash"></i><span>æ˜¾ç¤ºå…¨éƒ¨</span>';
            } else {
                btn.innerHTML = '<i class="fas fa-eye"></i><span>åªçœ‹è®¢é˜…</span>';
            }
            renderTable(stockList);
        }

        // æ¸…é™¤æ‰€æœ‰è®¢é˜…
        function clearAllSubscriptions() {
            if (confirm('ç¡®å®šæ¸…é™¤æ‰€æœ‰è®¢é˜…å—ï¼Ÿ')) {
                localStorage.removeItem(THIRD_BUY_STORAGE_KEY);
                // å¦‚æœå½“å‰æ˜¯åªçœ‹è®¢é˜…æ¨¡å¼ï¼Œåˆ™é€€å‡ºè¯¥æ¨¡å¼
                showSubscribedOnly = false;
                document.getElementById('show-subscribed-btn').innerHTML = '<i class="fas fa-eye"></i><span>åªçœ‹è®¢é˜…</span>';
                renderTable(stockList);
            }
        }

        // è®¢é˜…/å–æ¶ˆè®¢é˜…
        function toggleSubscribe(stock) {
            let subscribed = getSubscribedStocks();
            const index = subscribed.findIndex(item => item.code === stock.code);
            if (index === -1) {
                // è®¢é˜…ï¼šä¿å­˜å¿…è¦ä¿¡æ¯ï¼Œè‡³å°‘ code å’Œ name
                subscribed.push({ code: stock.code, name: stock.name });
            } else {
                // å–æ¶ˆè®¢é˜…
                subscribed.splice(index, 1);
            }
            saveSubscribedStocks(subscribed);
            // åˆ·æ–°è¡¨æ ¼ï¼ˆä¿æŒå½“å‰ç­›é€‰æ¨¡å¼ï¼‰
            renderTable(stockList);
        }

        // è·å–è®¢é˜…åˆ—è¡¨ï¼ˆä» localStorage è¯»å–ï¼‰
        function getSubscribedStocks() {
            const stored = localStorage.getItem(THIRD_BUY_STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        // ä¿å­˜è®¢é˜…åˆ—è¡¨
        function saveSubscribedStocks(subscribed) {
            localStorage.setItem(THIRD_BUY_STORAGE_KEY, JSON.stringify(subscribed));
        }

        // æ£€æŸ¥æŸè‚¡ç¥¨æ˜¯å¦å·²è®¢é˜…
        function isSubscribed(code) {
            const subscribed = getSubscribedStocks();
            return subscribed.some(item => item.code === code);
        }

        // ç›‘å¬æŸ¥è¯¢æ–¹å¼åˆ‡æ¢
        typeDate.addEventListener('change', function() {
            if (this.checked) {
                startDateInput.disabled = false;
                daysInput.disabled = true;
                daysInput.value = ''; // æ¸…ç©ºå¤©æ•°
            }
        });
            
        typeDays.addEventListener('change', function() {
            if (this.checked) {
                startDateInput.disabled = true;
                daysInput.disabled = false;
                startDateInput.value = ''; // æ¸…ç©ºèµ·å§‹æ—¥æœŸ
            }
        });

        showSubscribedBtn.addEventListener('click', toggleShowSubscribed);
        clearSubscriptionsBtn.addEventListener('click', clearAllSubscriptions);

        generateIndustryData();
        initQueryType();
    </script>
</body>